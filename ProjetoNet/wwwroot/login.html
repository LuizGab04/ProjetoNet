<!DOCTYPE html>
<html>
<head>
    <link href="../vendors/glightbox/glightbox.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700%7cPoppins:300,400,500,600,700,800,900&amp;display=swap" rel="stylesheet">
    <link href="../vendors/overlayscrollbars/OverlayScrollbars.min.css" rel="stylesheet">
    <link href="../assets/css/theme-rtl.min.css" rel="stylesheet" id="style-rtl">
    <link href="../assets/css/theme.min.css" rel="stylesheet" id="style-default">
    <link href="../assets/css/user-rtl.min.css" rel="stylesheet" id="user-style-rtl">
    <link href="../assets/css/user.min.css" rel="stylesheet" id="user-style-default">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <meta charset="utf-8" />
    <title>Fabrica de Software | Login</title>
    <style>
        #body-meio {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #form-login {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .preencha {
            border: 2px solid red !important;
            background-color: #ffe6e6;
        }
    </style>
</head>
<body style="background: linear-gradient(to right, #5800FF, #00d7FF) ">
    <main>
        <div id="body-meio">
            <div id="form-login">
                <div>
                    <h1>
                        Realize o seu Login ou Cadastro
                    </h1>
                    <div>
                        <form id="form-container">
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Endereço de e-mail</label>
                                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputPassword1" class="form-label">Senha</label>
                                <input type="password" class="form-control" id="exampleInputPassword1">
                            </div>
                        </form>
                    </div>
                    <div id="botoes-login">
                        <ul id="form-botoes" style=" list-style: none; display: flex; justify-content: center;">
                            <li class="p-3"><button type="submit" id="btLogin" class="btn btn-primary">Login</button></li>
                            <li class="p-3"><button id="btCadastrar" class="btn btn-secondary">Cadastro</button></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="scripts/login.js"></script>
    <script type="module">
        import { Usuario } from "../Modelos/ModeloUsuario.js"


        function addStyle() {
            const sheet = new CSSStyleSheet();
            sheet.insertRule(`#botoes-login { display: none; }`, 0);
            document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];
        }

        btCadastrar.onclick = () => {
            document.querySelector('h1').innerHTML = "Realize o seu Cadastro"
            document.getElementById("botoes-login").classList.add(addStyle())
            document.getElementById("form-container").innerHTML = `
                            <form>
                                <div class="mb-3">
                                    <label for="inputNome" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="inputNome">
                                </div>
                                 <div class="mb-3">
                                    <label for="exampleInputEmail1" class="form-label">Endereço de e-mail</label>
                                    <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
                                 </div>
                                 <div class="mb-3">
                                    <label for="exampleInputPassword1" class="form-label">Senha</label>
                                    <input type="password" class="form-control" id="exampleInputPassword1">
                                 </div>
                            </form>
                              <div>
                                <ul id="form-botoes" style=" list-style: none; display: flex; justify-content: center;">
                                    <li class="p-3"><button id="btVoltar" class="btn btn-primary">voltar</button></li>
                                    <li class="p-3"><button type="submit" id="btEnviarCadastro" class="btn btn-secondary">Cadastrar</button></li>
                                </ul>
                              </div>
                                `;

            document.getElementById("btEnviarCadastro").addEventListener("click", async function (event) {
                event.preventDefault(); // Evita o recarregamento da página

                // Captura os valores do formulário
                const nome = document.getElementById("inputNome").value;
                const email = document.getElementById("exampleInputEmail1").value;
                const senha = document.getElementById("exampleInputPassword1").value;

                // Validação simples
                if (!nome || !email || !senha) {
                    if (!nome) document.getElementById("inputNome").classList.add("preencha");
                    if (!email) document.getElementById("exampleInputEmail1").classList.add("preencha");
                    if (!senha) document.getElementById("exampleInputPassword1").classList.add("preencha");

                    Swal.fire({
                        title: "Preencha os campos vazios",
                        icon: "warning"
                    });
                    return;

                    document.querySelectorAll("input").forEach(input => {
                        input.addEventListener("input", function () {
                            this.classList.remove("preencha");
                        });
                    });
                }

                const usuario = {
                    nome_usuario: nome,
                    email_usuario: email,
                    senha_usuario: senha
                };

                console.log(usuario.email_usuario)
                try {
                    // Chama o método de cadastro na API
                    const validacao = await Usuario.validacaoEmail(usuario)
                    if (validacao == true) {
                        Swal.fire({
                            title: "Erro!",
                            text: "E-mail já cadastrado!",
                            icon: "error"
                        });
                        return;
                    } else {
                        console.log("E-mail disponível para cadastro.");
                        const resposta = await Usuario.cadastrarUsuario(usuario)
                        Swal.fire({
                            title: "Cadastrado com Sucesso!",
                            icon: "success",
                            draggable: true
                        });
                        setTimeout(() => {
                            location.reload()
                        }, 3000)
                    }
                } catch (error) {

                    console.error("Erro ao cadastrar usuário:", error)

                } finally {

                }
            });

            document.getElementById("btVoltar").addEventListener("click", () => {
                location.reload();
            });

        };

    </script>
</body>
</html>